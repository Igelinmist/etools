{% extends "base.html" %}

{% load uptime_extras %}

{% load staticfiles%}

{% block head_ext %}
  {{ form_date.media }}
{% endblock head_ext %}

{% block content %}
   <form action="" method="POST" class="form-inline">
      {% csrf_token %}
      {{ form_date }}
      <input type="submit" value="Принять" class="btn btn-primary" />
  </form><br />
  {% for data_row in data_table %}
      <div
        {% if data_row.has_record %}
          class="row has_data"
        {% else %}
          class="row"
        {% endif %}
      >
      {% if data_row.form_type %}
          <div class="col-md-2"><a href="{%url 'uptime:show' data_row.journal_id%}"><strong>{{ data_row.ident|make_ident }}{{ data_row.name }}</strong></a></div>
           <div class="col-md-10">
          <form action="{% url 'uptime:silent_record_create_or_update' %}" method="POST" class="form-inline record-form" id="record-form-{{data_row.journal_id}}" role="form">
          {% csrf_token %}
          <input type="hidden" name="journal_id" value="{{data_row.journal_id}}">
          {{data_row.form_content}}
          <input type="submit" value="Записать" 
            {% if data_row.has_record %}
              class="apply-btn invisible" 
            {% else %}
              class="apply-btn"
            {% endif %}
          >
          </form>
          </div>
      {% else %}
          <div class="col-md-12"><strong>{{ data_row.ident|make_ident }}{{ data_row.name }}</strong></div>
      {% endif %}
      </div>
  {% endfor %}
{% endblock content %}

{% block javascript %}
  <script type="text/javascript">
      $(document).ready(function() {
          $(".record-form").submit(function(event) {
              event.preventDefault();
              $.ajax({
                  data: $(this).serialize(),
                  type: $(this).attr("method"),
                  url: $(this).attr("action"),
                  success: function(data) {
                      $("#record-form-"+data.journal_id).css("color", "gray");
                      $("#record-form-"+data.journal_id).find(".apply-btn").css("display", "none")
                  }
              });
              return false;
          });
          $(".interval").bind("dblclick", function(e) {
            e.preventDefault();
            $(this).val("24:00");
            $(this).trigger("change")
          });
          $("input").change(function() {
            $(this).parent().find(".apply-btn").css("display", "inline")
          });
      });
  </script>
{% endblock javascript %}